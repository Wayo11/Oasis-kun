<!-- index.html — WhatsApp風チャットUI（スタンドアロン1ファイル）
 使い方：このHTMLを任意の静的ホスティングで開き、下部の GAS_URL をあなたのApps Script WebアプリURLに差し替えてください。
-->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsUp風チャット</title>
  <style>
    :root{
      --wa-green:#075E54; --wa-light:#128C7E; --bg:#ECE5DD; --me:#DCF8C6; --you:#FFFFFF; --text:#111; --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI",sans-serif;color:var(--text)}
    .app{height:100dvh;display:grid;grid-template-rows:auto 1fr auto;max-width:720px;margin:0 auto;border-left:1px solid #ddd;border-right:1px solid #ddd;background:#e7ddd1}
    .topbar{background:var(--wa-green);color:#fff;padding:10px 12px;display:flex;align-items:center;gap:12px;position:sticky;top:0}
    .avatar{width:36px;height:36px;border-radius:50%;background:#fff1;border:2px solid #fff3}
    .title{font-weight:700}
    .status{font-size:12px;opacity:.9}
    .chat{padding:12px;height:100%;overflow:auto;background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><text x="10" y="30" font-size="14" fill="%23c4b8a6" opacity="0.3">WhatsUp</text></svg>') repeat}
    .bubble{max-width:75%;padding:8px 10px;border-radius:16px;box-shadow:0 1px 0 rgba(0,0,0,.08);position:relative;margin:6px 0;word-wrap:break-word}
    .me{margin-left:auto;background:var(--me);border-top-right-radius:4px}
    .you{margin-right:auto;background:var(--you);border-top-left-radius:4px}
    .meta{display:flex;gap:8px;align-items:center;justify-content:flex-end;color:var(--muted);font-size:11px;margin-top:2px}
    .inputbar{background:#f6f6f6;padding:8px;display:flex;gap:8px;align-items:center;border-top:1px solid #e5e7eb}
    .field{flex:1;display:flex;align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:24px;padding:6px 10px}
    textarea{flex:1;border:none;outline:none;resize:none;min-height:20px;max-height:120px;background:transparent;font:inherit}
    .send{background:var(--wa-light);color:#fff;border:none;border-radius:22px;padding:10px 14px;font-weight:700;cursor:pointer}
    .send:disabled{opacity:.5;cursor:not-allowed}
    .typing{display:inline-flex;gap:3px;align-items:flex-end;height:14px}
    .typing span{width:6px;height:6px;border-radius:50%;background:#bbb;display:block;animation:b 1s infinite ease-in-out}
    .typing span:nth-child(2){animation-delay:.12s}
    .typing span:nth-child(3){animation-delay:.24s}
    @keyframes b{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-4px)}}
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <img class="avatar" alt="bot" src="https://api.iconify.design/ri:robot-2-fill.svg?color=white"/>
      <div>
        <div class="title">ChatGPT Bot</div>
        <div class="status" id="status">オンライン</div>
      </div>
    </header>

    <main class="chat" id="chat"></main>

    <footer class="inputbar">
      <div class="field"><textarea id="input" placeholder="メッセージを入力" rows="1"></textarea></div>
      <button class="send" id="send">送信</button>
    </footer>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbydGSOgo_hRnSwlUijYtqC6fp62_65KP62bgTuihlw-Dye9QYsvVRiv5f2qAjmoNpw/exec"; // ★差し替え必須
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const statusEl = document.getElementById('status');

    function nowTime(){const d=new Date();return d.toTimeString().slice(0,5)}

    function bubble(text, who='you'){
      const b=document.createElement('div'); b.className=`bubble ${who}`;
      b.innerHTML = `<div class="text">${escapeHtml(text).replace(/\n/g,'<br>')}</div>`+
                    `<div class="meta"><span>${nowTime()}</span></div>`;
      chat.appendChild(b); chat.scrollTop = chat.scrollHeight; return b;
    }

    function typingBubble(){
      const b=document.createElement('div'); b.className='bubble you';
      b.innerHTML = `<div class="typing"><span></span><span></span><span></span></div>`+
                    `<div class="meta"><span>入力中…</span></div>`;
      chat.appendChild(b); chat.scrollTop = chat.scrollHeight; return b;
    }

    function escapeHtml(s){return s.replace(/[&<>"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]))}

    async function send(){
      const text = input.value.trim(); if(!text) return;
      sendBtn.disabled = true; bubble(text,'me'); input.value=''; input.style.height='';
      const typing = typingBubble(); statusEl.textContent = 'ChatGPTが入力中…';
      try{
        const res = await fetch(GAS_URL,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},body:new URLSearchParams({message:text})});
        if(!res.ok){throw new Error('HTTP '+res.status)}
        const data = await res.json();
        const reply = data.reply || data.output_text || '';
        typing.remove(); bubble(reply || '(空の返答)', 'you');
      }catch(err){typing.remove(); bubble('エラー: '+err.message,'you')}
      finally{sendBtn.disabled=false; statusEl.textContent='オンライン'}
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); } });
    input.addEventListener('input', ()=>{ input.style.height='auto'; input.style.height = Math.min(input.scrollHeight, 120)+"px"; });

    // ウェルカム
    bubble('こんにちは！ChatGPTのAPIに接続しています。メッセージを送ってください。','you');
  </script>
</body>
</html>
