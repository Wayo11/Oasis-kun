<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oasis Chat</title>
  <style>
    :root{
      /* Desert & water palette */
      --sand:#E9DDBB;      /* light sand */
      --dune:#C8B27A;      /* deeper dune */
      --oasis:#2BA6CB;     /* water */
      --oasis-dark:#1E7F9A;/* water dark */
      --bg:#F7F1E0;        /* overall bg */
      --you:#FFFFFF;       /* bot bubble */
      --me:#D9F5FF;        /* my bubble (watery) */
      --text:#1b1b1b;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}

    /* App shell */
    .app{height:100dvh;display:grid;grid-template-rows:auto 1fr auto;max-width:760px;margin:0 auto;border-left:1px solid #e5e5e5;border-right:1px solid #e5e5e5;background:linear-gradient(180deg, #f7f1e0 0%, #f3ead2 100%)}
    .topbar{background:linear-gradient(90deg,var(--oasis-dark),var(--oasis));color:#fff;padding:12px 14px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:2}
    .avatar{width:36px;height:36px;border-radius:50%;background:#fff1;border:2px solid #ffffff44}
    .title{font-weight:700}
    .status{font-size:12px;opacity:.95}

    /* Chat */
    .chat{padding:12px;height:100%;overflow:auto;background:radial-gradient(1200px 400px at 50% -200px, #d9f5ff55, transparent),
             repeating-linear-gradient( -45deg, #0000 0 10px, #ffffff10 10px 20px)}
    .bubble{max-width:75%;padding:10px 12px;border-radius:16px;box-shadow:0 1px 0 rgba(0,0,0,.08);position:relative;margin:8px 0;word-wrap:break-word}
    .me{margin-left:auto;background:var(--me);border-top-right-radius:4px}
    .you{margin-right:auto;background:var(--you);border-top-left-radius:4px}
    .meta{display:flex;gap:8px;align-items:center;justify-content:flex-end;color:var(--muted);font-size:11px;margin-top:4px}

    .inputbar{background:#f8fafc;padding:10px;display:flex;gap:8px;align-items:center;border-top:1px solid #e5e7eb}
    .field{flex:1;display:flex;align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:24px;padding:8px 12px}
    textarea{flex:1;border:none;outline:none;resize:none;min-height:22px;max-height:140px;background:transparent;font:inherit}
    .send{background:var(--oasis);color:#fff;border:none;border-radius:22px;padding:10px 16px;font-weight:700;cursor:pointer}
    .send:disabled{opacity:.5;cursor:not-allowed}

    .typing{display:inline-flex;gap:3px;align-items:flex-end;height:14px}
    .typing span{width:6px;height:6px;border-radius:50%;background:#9ccfe0;display:block;animation:b 1s infinite ease-in-out}
    .typing span:nth-child(2){animation-delay:.12s}
    .typing span:nth-child(3){animation-delay:.24s}
    @keyframes b{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-4px)}}

    /* Splash screen */
    .splash{position:fixed;inset:0;z-index:10;display:grid;place-items:center;background:linear-gradient(180deg,#f4e9cc 0%, #e7d6a7 60%, #dbeff6 100%)}
    .splash-card{display:flex;flex-direction:column;align-items:center;gap:18px;text-align:center;padding:28px 22px;background:#ffffffcc;border:1px solid #ffffff88;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .splash-icon{width:110px;height:110px;border-radius:999px;display:grid;place-items:center;background:radial-gradient(circle at 30% 30%, #ffffff, #b7e7f6);border:3px solid #ffffff}
    .splash-title{font-weight:800;font-size:20px}
    .splash-sub{color:#4b5563;font-size:14px;max-width:22em}
    .splash-btn{position:relative;overflow:hidden;isolation:isolate;background:var(--oasis-dark);color:#fff;border:none;border-radius:999px;padding:12px 20px;font-weight:800;cursor:pointer;transition:transform .06s ease}
    .splash-btn:active{transform:translateY(1px)}
    /* Ripple effect */
    .ripple{position:absolute;border-radius:50%;transform:scale(0);opacity:.6;background:#fff;animation:ripple .6s ease-out forwards;pointer-events:none}
    @keyframes ripple{to{transform:scale(4);opacity:0}}

    .hidden{display:none!important}
  </style>
</head>
<body>
  <!-- Splash overlay -->
  <div class="splash" id="splash">
    <div class="splash-card">
      <div class="splash-icon">
        <img src="https://api.iconify.design/mdi:water-opacity.svg" alt="Oasis-kun"/>
      </div>
      <div class="splash-title" id="splashTitle">Meet Oasis‑kun</div>
      <div class="splash-sub" id="splashSub">A friendly local desert fairy who knows water by heart. Tap to begin your conversation.</div>
      <button id="startBtn" class="splash-btn">Start conversation</button>
    </div>
  </div>

  <div class="app hidden" id="app">
    <header class="topbar">
      <img class="avatar" alt="Oasis-kun" src="https://api.iconify.design/mdi:water.svg?color=white"/>
      <div>
        <div class="title">Oasis‑kun</div>
        <div class="status" id="status">Online</div>
      </div>
      <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
        <label for="langSel" style="font-size:12px;opacity:.9">Language</label>
        <select id="langSel" style="appearance:none;border:1px solid #ffffff66;background:#ffffff22;color:#000000;padding:6px 10px;border-radius:999px;backdrop-filter:blur(3px)">
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="ar">العربية</option>
        </select>
      </div>
    </header>

    <main class="chat" id="chat"></main>

    <footer class="inputbar">
      <div class="field"><textarea id="input" placeholder="Type a message" rows="1"></textarea></div>
      <button class="send" id="send">Send</button>
    </footer>
  </div>

  <script>
    // === Configure ===
    const GAS_URL = "PASTE_YOUR_APPS_SCRIPT_WEB_APP_URL_HERE"; // Insert your Apps Script Web App URL

    // === i18n ===
    const I18N = {
      en: {
        splashTitle: 'Meet Oasis‑kun',
        splashSub: 'A friendly local desert fairy who knows water by heart. Tap to begin your conversation.',
        start: 'Start conversation',
        welcome: "Salām, my friend. I'm Oasis‑kun. Ask me anything about water, farming, or village life.",
        online: 'Online',
        typing: 'Oasis‑kun is typing…',
        placeholder: 'Type a message',
        send: 'Send',
        answerIn: 'Please answer in English.'
      },
      ja: {
        splashTitle: 'オアシス君に会おう',
        splashSub: '水に詳しい砂漠の妖精。下のボタンで会話を始めよう。',
        start: '会話を始める',
        welcome: 'サラーム、友よ。僕はオアシス君。水・農業・村の暮らし、何でも聞いてね。',
        online: 'オンライン',
        typing: 'オアシス君が入力中…',
        placeholder: 'メッセージを入力',
        send: '送信',
        answerIn: 'Please answer in Japanese.'
      },
      ar: {
        splashTitle: 'تعرّف على أويسِس‑كون',
        splashSub: 'جنيٌّ محلي من الصحراء خبيرٌ بالماء. اضغط لبدء المحادثة.',
        start: 'ابدأ المحادثة',
        welcome: 'سلام يا صديقي. أنا أويسِس‑كون. اسألني عن الماء أو الزراعة أو حياة القرية.',
        online: 'متصل',
        typing: 'أويسِس‑كون يكتب…',
        placeholder: 'اكتب رسالة',
        send: 'إرسال',
        answerIn: 'Please answer in Arabic.'
      }
    };
    let currentLang = 'en';

    // === Elements ===
    const splash = document.getElementById('splash');
    const startBtn = document.getElementById('startBtn');
    const app = document.getElementById('app');
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const statusEl = document.getElementById('status');

    function nowTime(){const d=new Date();return d.toTimeString().slice(0,5)}

    function bubble(text, who='you'){
      const b=document.createElement('div'); b.className=`bubble ${who}`;
      b.innerHTML = `<div class="text">${escapeHtml(text).replace(/\n/g,'<br>')}</div>`+
                    `<div class="meta"><span>${nowTime()}</span></div>`;
      chat.appendChild(b); chat.scrollTop = chat.scrollHeight; return b;
    }

    function typingBubble(){
      const b=document.createElement('div'); b.className='bubble you';
      b.innerHTML = `<div class="typing"><span></span><span></span><span></span></div>`+
                    `<div class=\"meta\"><span>${I18N[currentLang].typing}</span></div>`;
      chat.appendChild(b); chat.scrollTop = chat.scrollHeight; return b;
    }

    function escapeHtml(s){return s.replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]))}

    async function send(){
      const text = input.value.trim(); if(!text) return;
      sendBtn.disabled = true; bubble(text,'me'); input.value=''; input.style.height='';
      const typing = typingBubble(); statusEl.textContent = I18N[currentLang].typing;
      try{
        const langHint = I18N[currentLang].answerIn;
        const res = await fetch(GAS_URL,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},body:new URLSearchParams({message: `${langHint}\n\n${text}`, lang: currentLang})});
        if(!res.ok){throw new Error('HTTP '+res.status)}
        const data = await res.json();
        const reply = data.reply || data.output_text || '';
        typing.remove(); bubble(reply || '(no reply)', 'you');
      }catch(err){typing.remove(); bubble('Error: '+err.message,'you')}
      finally{sendBtn.disabled=false; statusEl.textContent=I18N[currentLang].online}
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); } });
    input.addEventListener('input', ()=>{ input.style.height='auto'; input.style.height = Math.min(input.scrollHeight, 140)+"px"; });

    // Splash → App
    function startConversation(){
      app.classList.remove('hidden');
      splash.classList.add('hidden');
      bubble(I18N[currentLang].welcome, 'you');
    }

    // Ripple effect on button + start
    startBtn.addEventListener('click', (e)=>{
      const rect = startBtn.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const span = document.createElement('span');
      span.className = 'ripple';
      span.style.width = span.style.height = size + 'px';
      span.style.left = (e.clientX - rect.left - size/2) + 'px';
      span.style.top  = (e.clientY - rect.top  - size/2) + 'px';
      startBtn.appendChild(span);
      setTimeout(()=> span.remove(), 620);
      // Start after a tiny delay so ripple is visible
      setTimeout(startConversation, 120);
    });

    // Optional: allow Enter key to focus input after splash hidden
    document.addEventListener('keydown', (e)=>{
      if(!app.classList.contains('hidden')) return;
      if(e.key==='Enter'){ startConversation(); }
    });

    // Language setup
    const langSel = document.getElementById('langSel');
    const splashTitle = document.getElementById('splashTitle');
    const splashSub = document.getElementById('splashSub');

    function setLang(lang){
      currentLang = lang in I18N ? lang : 'en';
      const t = I18N[currentLang];
      // UI text
      splashTitle.textContent = t.splashTitle;
      splashSub.textContent = t.splashSub;
      startBtn.textContent = t.start;
      statusEl.textContent = t.online;
      input.placeholder = t.placeholder;
      sendBtn.textContent = t.send;
      // Direction
      document.documentElement.setAttribute('lang', currentLang);
      document.documentElement.dir = (currentLang==='ar') ? 'rtl' : 'ltr';
    }

    langSel.addEventListener('change', ()=> setLang(langSel.value));
    // init
    setLang('en');
  </script>
</body>
</html>
